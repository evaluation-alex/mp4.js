<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../src/mp4.utils.js"></script>
		<script type="text/javascript" src="../src/mp4.descr.js"></script>
		<script type="text/javascript" src="../src/mp4.box.js"></script>
		<script type="text/javascript" src="../src/mp4.main.js"></script>
		<script>
			window.onload = function() {
				var URL = window.URL || window.webkitURL;
				//see: http://www.html5rocks.com/en/tutorials/file/dndfiles/
				document.getElementById("files").addEventListener('change', function(e) {
					var files = e.target.files;

					for(var i = 0, f; f = files[i]; ++i) {
						var reader = new FileReader();

						reader.onload = (function(theFile) {
							return function(e) {
								parser = new mp4.Parser(e.target.result);
								document.getElementById("result").innerText = JSON.stringify(parser.parse(), null, 2);
								location.href = URL.createObjectURL(parser.extractAACAsBlob());
							};
						})(f);

						reader.readAsArrayBuffer(f);
					}
				}, false);
			};

		</script>
	</head>
	<body>
		<input type="file" id="files" name="files[]" multiple/>
		<pre id="result"></pre>
	</body>
</html>